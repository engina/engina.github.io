<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Windows, PHP, cURL SSL certificate problem. - Engin AYDOGAN's Journal</title>
        <meta name="viewport" content="width=device-width">
        <script src="//cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
        <script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha3.js"></script>
        <script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes.js"></script>

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Engin AYDOGAN's Journal</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Windows, PHP, cURL SSL certificate problem.</h2>
<p class="meta">02 Feb 2012</p>

<div class="post">
<p>When you use a library that wraps an API (Facebook PHP SDK, AWS PHP SDK) usage, it often boils down to cURL in the core. These libraries often want to communicate over SSL by default. So, any call you make on these libraries involves a cURL request over a SSL connection. The problem with this is that cURL does not ship CA certificates bundle any more, so SSL certificates of the sites the requests are addressed to cannot be verified.</p>
<p>For instance, with AWS PHP SDK, you'll get the following error if your cURL setup is not fixed:</p>
<pre class="prettyprint"><strong>Fatal error</strong>: Uncaught exception 'cURL_Exception' with message 'cURL resource: Resource id #10; cURL error: SSL certificate problem, verify that the CA cert is OK. Details:
error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed (cURL error code 60). See http://curl.haxx.se/libcurl/c/libcurl-errors.html for an explanation of error codes.' in C:\Users\Engin\Code\PHP\unuttumbile\AWSSDKforPHP\lib\requestcore\requestcore.class.php:824
Stack trace:
#0 C:\Users\Engin\Code\PHP\unuttumbile\AWSSDKforPHP\services\s3.class.php(895): RequestCore-&gt;send_request()
#1 C:\Users\Engin\Code\PHP\unuttumbile\AWSSDKforPHP\services\s3.class.php(1125): AmazonS3-&gt;authenticate('php-sdk-getting...', Array)
#2 C:\Users\Engin\Code\PHP\unuttumbile\AWSSDKforPHP\_samples\cli-s3_get_urls_for_uploads.php(60): AmazonS3-&gt;create_bucket('php-sdk-getting...', 's3-us-west-1.am...')
#3 {main}
thrown in <strong>C:\Users\Engin\Code\PHP\unuttumbile\AWSSDKforPHP\lib\requestcore\requestcore.class.php</strong> on line <strong>824</strong></pre>
<p>cURL explains the situation in depth <a href="http://curl.haxx.se/docs/sslcerts.html">here</a>.</p>
<p>2 step easy <strong>solution</strong>:</p>
<div>
<ol>
<li><span style="line-height: normal;">Generate CA bundle yourself via scripts provided by cURL. Either via <a href="https://raw.github.com/bagder/curl/master/lib/mk-ca-bundle.pl">mk-ca-bundle.pl</a> (PERL) or <a href="https://raw.github.com/bagder/curl/master/lib/mk-ca-bundle.vbs">mk-ca-bundle.vbs</a> (Windows Shell). Then copy it to c:\Windows just for convenience.</span>
<pre class="prettyprint">Engin@Engin-VAIO ~
$ perl mk-ca-bundle.pl
Downloading 'certdata.txt' ...
Processing  'certdata.txt' ...
Done (137 CA certs processed, 32 untrusted skipped).

Engin@Engin-VAIO ~
$ cp ca-bundle.crt /cygdrive/c/Windows/ -vf
`ca-bundle.crt' -&gt; `/cygdrive/c/Windows/ca-bundle.crt'</pre>
</li>
<li><span style="line-height: normal;">Then add the following line in your php.ini's [PHP] section. Note that this configuration option is available since PHP 5.3.7. See <a href="http://www.php.net/manual/en/curl.configuration.php">not so very detailed info</a>.</span>
<pre class="prettyprint">[PHP]
curl.cainfo = c:\windows\ca-bundle.crt</pre>
</li>
<li>Restart your HTTP server and you're done.</li>
</ol>
</div>

</div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'enginsjournal'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

          <div class="footer">
            <div class="contact">
              <p>
                Engin AYDOGAN<br />
                Thinker<br />
                e@ea.tl
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/engina">github.com/engina</a><br />
                <a href="https://twitter.com/jastsayn">twitter.com/jastsayn</a><br />
              </p>
            </div>
          </div>
        </div>
    </body>
    <script type="text/javascript">
    var k = [];
    $(document).ready(function(){
      $(document).keypress(function(e){
        k.push(e.which);

        while(k.length > 64) {
          k.shift();
        }

        if(e.which != 13) return;
        k.pop();
        // OMG! OMG! OMG! Is this an easter egg?
        if(CryptoJS.SHA3(k.join()).toString() == 'd24cbabf2cfe116cd74597b61095a44f40bcc89d7b1acde8158ad23c38b5409a84d37d3c00a74639b4f5df228d2d734a52b93675fd60a5ad56a303c79950e8d3') {
          var p = ''; $(k).each(function(e,b){p += String.fromCharCode(b);});
          document.location.href = CryptoJS.enc.Utf8.stringify(CryptoJS.AES.decrypt('U2FsdGVkX188+NsdA42FiRFwL9yG8aa/GEgHdIO2Cpw=', p));
        }
        k = [];
      });
    });
    </script>
</html>
