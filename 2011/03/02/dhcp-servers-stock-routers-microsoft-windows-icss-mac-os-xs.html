<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>DHCP Servers: Stock routers', Microsoft Windows ICS's, Mac OS X's - Engin AYDOGAN's Journal</title>
        <meta name="viewport" content="width=device-width">
        <script src="//cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
        <script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha3.js"></script>
        <script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes.js"></script>

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Engin AYDOGAN's Journal</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>DHCP Servers: Stock routers', Microsoft Windows ICS's, Mac OS X's</h2>
<p class="meta">02 Mar 2011</p>

<div class="post">
<p>MS Windows and Mac OS X let's you share your internet from one network interface to another one. i.e. You can share your Wireless internet to your Ethernet port. In Windows it is called ICS (Internet Connection Sharing). In Mac OS X, you can do it in the Sharing section for your settings. Not surprisingly, Mac OS X UI is much more intuitive.</p>
<p>In a few days, we'll be in an industrial automation fair and only available internet connection there will be Wireless. We want to connect our devices to internet there but our devices only have Ethernet port. So we'll rely on connection sharing of one of these OSes. The problem is that their DHCP servers are acting a bit different than a stock router you'd have.</p>
<p>Windows does not give responses quickly, after my DHCP REQUEST message, it takes a like 1-2 seconds to get ACK message back. And Windows's DHCP server keeps sending OFFERs and ACKs like crazy for the previously received messages even though an IP address is acquired already. Tweaking the timeouts and making sure my client does not honor OFFERs once that state is passed fixed the issues with Windows' DHCP server.</p>
<p>However the issue with the Mac was a more subtle one. My device couldn't acquire IP address at all. I checked if my Windows laptop could get an IP from it and, not surprisingly, it could! My device couldn't even get an OFFER for its DISCOVER message. I compared Windows' DISCOVER message with mine to find the differences. There were two differenes:</p>
<ol>
<li>Seconds field</li>
<li>Options field</li>
</ol>
<div>First I tried to make the Options field identical. Of course, Murphy's laws applied and it turned out that it is because of Seconds field. When I changed my Seconds field from 0 to 4 (like Windows do) it all worked out with Mac's DHCP server.</div>
<div>According to <a href="http://tools.ietf.org/html/rfc2131">RFC 2131</a>'s Section 2, page 10, the Seconds field is for:</div>
<blockquote><p>secs          2  Filled in by client, seconds elapsed since client began address acquisition or renewal process.</p></blockquote>
<p>I don't see how this affects the behavior but it fixes the issue.</p>
<p>See also <a href="http://engin.bzzzt.biz/2010/07/20/zero-configuration-connectivity-on-embedded-computers/">previous mistake I made about DHCP</a>.</p>
<p>Cheers</p>

</div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'enginsjournal'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

          <div class="footer">
            <div class="contact">
              <p>
                Engin AYDOGAN<br />
                Thinker<br />
                e@ea.tl
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/engina</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/jastsayn</a><br />
              </p>
            </div>
          </div>
        </div>
    </body>
    <script type="text/javascript">
    var k = [];
    $(document).ready(function(){
      $(document).keypress(function(e){
        console.log(e);
        k.push(e.which);

        while(k.length > 64) {
          k.shift();
        }
        if(e.which != 13) return;
        // OMG! OMG! OMG! Is this an easter egg?
        k.pop();
        if(CryptoJS.SHA3(k.join()).toString() == 'd24cbabf2cfe116cd74597b61095a44f40bcc89d7b1acde8158ad23c38b5409a84d37d3c00a74639b4f5df228d2d734a52b93675fd60a5ad56a303c79950e8d3') {
          var p = ''; $(k).each(function(e,b){p += String.fromCharCode(b);});
          document.location.href = CryptoJS.enc.Utf8.stringify(CryptoJS.AES.decrypt('U2FsdGVkX188+NsdA42FiRFwL9yG8aa/GEgHdIO2Cpw=', p));
        }
        k = [];
      });
    });
    </script>
</html>
