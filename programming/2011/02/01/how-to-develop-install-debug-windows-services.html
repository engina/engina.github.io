<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>How to develop, install, debug Windows Services</title>
        <meta name="viewport" content="width=device-width">
        <script src="//cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js" type="text/javascript"></script>
        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>How to develop, install, debug Windows Services</h2>
<p class="meta">01 Feb 2011</p>

<div class="post">
<div id="_mcePaste">
<ol>
<li>Create a Windows Service project.</li>
<li>Read documentation about the methods (OnStart and OnStop) you had to implement and implement them</li>
<li>Try to debug.</li>
<li>You'll get:
<pre class="prettyprint">Cannot start service from the command line or a debugger. A Windows Service must first be installed (using installutil.exe) and then started with the ServerExplorer, Windows Services Administrative tool or the NET START command.</pre>
</li>
<li>InstallUtil.exe is in c:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe for me. There was another InstallUtil before that, in the PATH. Hence I needed the absolute path.</li>
<li>When you try to install your service, if you look close enough you'll see:
<pre class="prettyprint">No public installers with the RunInstallerAttribute.Yes attribute could be found in the c:\Users\Engin\Code\RunawayKiller\RunawayKiller\bin\Debug\RunawayKiller.exe assembly.</pre>
</li>
<li>It turns out you need to have a special public class in your assembly to tell InstallUtil.exe what to do. Here's my class:
<pre class="prettyprint">using System;
using System.Collections.Generic;
using System.Text;
using System.ComponentModel;
using System.ServiceProcess;

namespace RunawayKiller
{
    [RunInstaller(true)]
    public class ProjectInstaller : System.Configuration.Install.Installer
    {
        private ServiceInstaller serviceInstaller;
        private ServiceProcessInstaller processInstaller;
        public ProjectInstaller()
        {
            processInstaller = new ServiceProcessInstaller();
            serviceInstaller = new ServiceInstaller();

            processInstaller.Account = ServiceAccount.LocalSystem;
            serviceInstaller.StartType = ServiceStartMode.Manual;

            serviceInstaller.ServiceName = "Runaway Process Killer";

            Installers.Add(serviceInstaller);
            Installers.Add(processInstaller);
        }
    }
}</pre>
</li>
<li>Now, when you InstallUtil.exe your assembly, you'll see your service in the Windows Services list. You can run it.</li>
<li>You need to do this InstallUtil installation just once. When you update your assembly (i.e. with new code) just restart the service and your new code will run.</li>
<li>Debugging is still not straightforward. <a href="http://msdn.microsoft.com/en-us/library/7a50syb3(v=vs.80).aspx">Documentations</a> tell that you need to go "Debug &gt; Attach to process" and attach to the running service. In my case, it was greyed out.</li>
<li>A work around is to call <em>System.Diagnostics.Debugger.Launch();</em> to trigger Windows to launch a debugger to the debug the process. I put this on <em>OnStart</em></li>
<li>When you run the service, Windows will ask you to chose a debugger. You instance won't be listed there unless you run Visual Studio with administrator privileges. I recommend you to do so. Run Visual Studio with administrator privileges and open your Windows Service project. And when you start your service, chose that instance of Visual Studio to debug. It will tell you <em>There is no source code available for the current location. </em>Don't mind this warning and click OK.</li>
<li>Now you can set break points in your source code and click Continue to run your service.</li>
</ol>
</div>
<p>Disclaimer: These are my notes from a 45 minute trip during rush hour and not necessarily the best practices whatsoever.</p>

</div>


          <div class="footer">
            <div class="contact">
              <p>
                Engin AYDOGAN<br />
                Thinker<br />
                e@ea.tl
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/engina</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/jastsayn</a><br />
                <a class="extra" href="90s/">90s</a>
              </p>
            </div>
          </div>
        </div>
    </body>
</html>
